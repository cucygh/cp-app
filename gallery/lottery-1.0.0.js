define(['zepto', 'underscore'], function ($, Lot) {
	var domain = 'http://ygh.cp.360.cn';
	// 彩种简称、ID、全称
	var lottery = {
		ssq : [220051, '双色球'],
		slt : [120029, '超级大乐透'],
		p3 : [110033, '排列三'],
		p5 : [110035, '排列五'],
		qxc : [110022, '七星彩'],
		sd : [210053, '福彩3D'],
		sdbj : [215152, '北京3D'],
		qlc : [220028, '七乐彩'],
		xw : [223515, '东方15选5'],
		xwtj : [225303, '天津15选5'],
		jczq : [130042, '竞彩足球'],
		jclq : [130043, '竞彩篮球'],
		dc : [130041, '北京单场'],
		sfc : [130011, '胜负彩'],
		rj : [130019, '任选九'],
		kl8 : [265108, '北京快乐8'],
		syxwsd : [166406, '山东11选5'],
		syxwjx : [168009, '新11选5'],
		syxwgd : [165707, '广东11选5'],
		syxwsh : [165207, '上海11选5'],
		syxwhlj : [166507, '幸运11选5'],
		sscjx : [258001, '江西时时彩'],
		ssccq : [255401, '重庆时时彩'],
		k3js : [255903, '江苏快3'],
		k3hb : [257703, '湖北快3'],
		k3nm : [257503, '内蒙快3'],
		k3jl : [258203, '吉林快3'],
		pk3 : [166407, '山东快乐扑克3'],
		jq4 : [130018, '四场进球'],
		zc6 : [130016, '6场半全场']
	};
	// 支付URL
	var pay_url = {
		bet : domain + '/int/bet/',
		team : domain + '/int/teambet/',
		join : domain + '/int/join/',
		trace : domain + '/int/trace/',
		pteam : domain + '/int/pteambet/'
	};
	/**
	 * 字符串相关
	 */
	var string = {
		/**
		 * 简单的模板编译
		 * @param tpl {string}
		 * @param data {Object}
		 * @return tpl {string}
		 */
		compile : function (tpl, data) {
			var reg;
			for (var p in data) {
				reg = new RegExp('\{' + p + '\}', 'g');
				tpl = tpl.replace(reg, data[p]);
			}
			return tpl;
		}
	};

	/**
	 * 投注相关
	 */
	var bet = {
		/**
		 * 获取彩种信息，含简写、id、全称
		 * @param name {String} 					eg:'130016' || 'zc6' || '6场半全场' || '6场' || '半全场'
		 * @ignore created
		 * @return result {Array}				eg:['zc6',130016, '6场半全场']
		 */
		get_lot_name : function (name) {
			var by_name = /^[a-z\d]+$/gi.test(name);
			var by_id = /^\d+$/.test(name);
			var index = 0;
			if (!by_name) {
				index = by_id ? 1 : 2;
			}
			var p_arr = [];
			for (var p in lottery) {
				p_arr = [p].concat(lottery[p]);
				if (lottery[p][index].indexOf(name) > -1) {
					break;
				}
			}
			return p_arr;
		},
		/**
		 * 获取支付URL
		 * @param con {String}
		 * @ignore created
		 * @return result {Array}
		 */
		get_pay_url : function (con) {
			var refer = {
				bet : '代购',
				team : '合买',
				join : '认购',
				trace : '追号',
				pteam : '先发起'
			};
			var p,
			url;
			for (p in refer) {
				if (con.indexOf(p) > -1 || con.indexOf(refer[p]) > -1) {
					url = pay_url[p];
					break;
				}
			}
			return url || false;
		},
		/**
		 * 获取彩种基本信息
		 * @param id {String}
		 * @ignore created
		 * @return result {Object}
		 */
		get_cur_issue : function (param) {
			var url = domain + '/int/qcurissue';
			var id = param.id;
			var cur_issue = param.cur_issue;
			var freq = param.freq;
			var ok_call = param.ok_call || function () {};
			var fail_call = param.fail_call || function () {};
			$.ajax({
				url : url,
				type : 'GET',
				data : {
					LotID : id
				},
				dataType : 'json',
				async : cur_issue ? true : false,
				success : function (data) {
					if (data) {
						if (cur_issue != undefined && cur_issue == data.issue) {
							setTimeout(function () {
								get_cur_issue.call(null, id, cur_issue);
							}, freq || 3000);
						} else {
							ok_call.call(null, data);
						}
					} else {
						fail_call.call(null);
					}
				},
				error : function () {
					fail_call.call(null);
				},
				timeout : 1000
			})
		}
	}
	return {
		string : string,
		bet : bet
	}
});
