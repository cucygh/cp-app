define(["zepto"],function($){$.pgwModal=function(obj){var pgwModal={},defaults={mainClassName:"pgwModal",backdropClassName:"pgwModalBackdrop",maxWidth:500,titleBar:!0,closable:!0,closeOnEscape:!0,closeOnBackgroundClick:!0,closeContent:'<span class="pm-icon"></span>',loadingContent:"Loading in progress...",errorContent:"An error has occured. Please try again in a few moments."};typeof window.pgwModalObject!="undefined"&&(pgwModal=window.pgwModalObject);if(typeof obj=="object"&&!obj.pushContent){if(!obj.url&&!obj.target&&!obj.content)throw new Error('PgwModal - There is no content to display, please provide a config parameter : "url", "target" or "content"');pgwModal.config={},pgwModal.config=$.extend({},defaults,obj),window.pgwModalObject=pgwModal}var create=function(){var appendBody='<div id="pgwModalBackdrop"></div><div id="pgwModal"><div class="pm-container"><div class="pm-body"><span class="pm-close"></span><div class="pm-title"></div><div class="pm-content"></div></div></div></div>'
;return $("body").append(appendBody),$(document).trigger("PgwModal::Create"),!0},reset=function(){return $("#pgwModal .pm-title, #pgwModal .pm-content").html(""),$("#pgwModal .pm-close").html("").unbind("click"),!0},angularCompilation=function(){return angular.element("body").injector().invoke(function($compile){var scope=angular.element($("#pgwModal .pm-content")).scope();$compile($("#pgwModal .pm-content"))(scope),scope.$digest()}),!0},pushContent=function(content){return $("#pgwModal .pm-content").html(content),pgwModal.config.angular&&angularCompilation(),reposition(),$(document).trigger("PgwModal::PushContent"),!0},reposition=function(){$("#pgwModal, #pgwModalBackdrop").show();var windowHeight=$(window).height(),modalHeight=$("#pgwModal .pm-body").height(),marginTop=Math.round((windowHeight-modalHeight)/3);return marginTop<=0&&(marginTop=0),$("#pgwModal .pm-body").css("margin-top",marginTop),!0},getData=function(){return pgwModal.config.modalData},getScrollbarWidth=function(){},isOpen=
function(){return $("body").hasClass("pgwModalOpen")},close=function(){$("#pgwModal, #pgwModalBackdrop").removeClass().hide(),$("body").css("padding-right","").removeClass("pgwModalOpen"),reset(),$(window).unbind("resize.PgwModal"),$(document).unbind("keyup.PgwModal"),$("#pgwModal").unbind("click.PgwModalBackdrop");try{delete window.pgwModalObject}catch(e){window.pgwModalObject=undefined}return $(document).trigger("PgwModal::Close"),!0},open=function(){$("#pgwModal").length==0?create():reset(),$("#pgwModal").removeClass().addClass(pgwModal.config.mainClassName),$("#pgwModalBackdrop").removeClass().addClass(pgwModal.config.backdropClassName),pgwModal.config.closable?$("#pgwModal .pm-close").html(pgwModal.config.closeContent).click(function(){close()}).show():$("#pgwModal .pm-close").html("").unbind("click").hide(),pgwModal.config.titleBar?$("#pgwModal .pm-title").show():$("#pgwModal .pm-title").hide(),pgwModal.config.title&&$("#pgwModal .pm-title").text(pgwModal.config.title),pgwModal.config
.maxWidth&&$("#pgwModal .pm-body").css("max-width",pgwModal.config.maxWidth);if(pgwModal.config.url){pgwModal.config.loadingContent&&$("#pgwModal .pm-content").html(pgwModal.config.loadingContent);var ajaxOptions={url:obj.url,success:function(data){pushContent(data)},error:function(){$("#pgwModal .pm-content").html(pgwModal.config.errorContent)}};pgwModal.config.ajaxOptions&&(ajaxOptions=$.extend({},ajaxOptions,pgwModal.config.ajaxOptions)),$.ajax(ajaxOptions)}else pgwModal.config.target?pushContent($(pgwModal.config.target).html()):pgwModal.config.content&&pushContent(pgwModal.config.content);pgwModal.config.closeOnEscape&&pgwModal.config.closable&&$(document).bind("keyup.PgwModal",function(e){e.keyCode==27&&close()}),pgwModal.config.closeOnBackgroundClick&&pgwModal.config.closable&&$("#pgwModal").bind("click.PgwModalBackdrop",function(e){var targetClass=$(e.target).hasClass("pm-container"),targetId=$(e.target).attr("id");(targetClass||targetId=="pgwModal")&&close()}),$("body").addClass
("pgwModalOpen");var currentScrollbarWidth=getScrollbarWidth();return currentScrollbarWidth>0&&$("body").css("padding-right",currentScrollbarWidth),$(window).bind("resize.PgwModal",function(){reposition()}),$(document).trigger("PgwModal::Open"),!0};if(typeof obj=="string"&&obj=="close")return close();if(typeof obj=="string"&&obj=="reposition")return reposition();if(typeof obj=="string"&&obj=="getData")return getData();if(typeof obj=="string"&&obj=="isOpen")return isOpen();if(typeof obj=="object"&&obj.pushContent)return pushContent(obj.pushContent);if(typeof obj=="object")return open()}});